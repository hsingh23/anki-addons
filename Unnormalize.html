<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Unnormalize – Ospalh’s Anki2 addons</title>
    <link rel="icon" type="image/png" href="/anki-addons/images/オ.png"/>
    <link rel="apple-touch-icon" href="/anki-addons/images/オ.png"/>
    <link rel="stylesheet/less" type="text/css" href="/anki-addons/css/styles.less">
    
    <script src="/anki-addons/scripts/less-1.3.0.min.js" type="text/javascript"></script>
    <!-- Internet Explorer HTML5 enabling script: -->
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <style type="text/css"> .clear {zoom: 1;display: block;} figure img{display:block;} </style>
    <![endif]-->
  </head>
  <body>
    <section id="page">
      <header>
        <nav class="clear">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/anki-addons/">Anki add-ons</a></li>
            
            <li><a href="https://github.com/ospalh/anki-addons" class="code">GitHub project</a></li>
            <li><a href="https://github.com/ospalh/anki-addons/tarball/master" class="download-button">Project tarball</a></li>
            <li><a href="https://github.com/ospalh/anki-addons/zipball/master" class="download-button zip">Project zipball</a></li>
            
      <li><a href="https://github.com/ospalh/anki-addons/blob/master/unnormalize.py" class="code">Add-on source</a></li>


          </ul>
        </nav>
      
  <h1>Unnormalize</h1>
  
  <h3>An Anki2 add-on</h3>
  

      </header>
      
<article id="unnormalize" class="clear">
  <div class="articleBody">

    <figure>
      <img src="/anki-addons/images/tuebingen_tuebingen.png" alt="Screen text: In media folder but not used by any cards: Tübingen_Neckarfront.jpg Used on cards but missing from media folder: Tübingen_Neckarfront.jpg." />
     <figcaption>So, the file is there and it is missing‽</figcaption>
    </figure>

    
    <p>This can be used to fix a problem caused by adding files “sideways” on
Macs.</p>
<h2>The problem</h2>
<p>When files are added not with the file add dialog through the paper
clip icon, but through other ways,</p>
<ul>
<li>by copying them to the media folder by hand and adding the text to
  display them to the fields,</li>
<li>through other tools like older versions (up to version 2.3.4, 24
  January 2013) of my <a href="Download%20audio.html">Download audio</a> add-on,</li>
<li>or possibly by drag-and-dropping them from the Finder,</li>
</ul>
<p>there may be a problem caused by a quirk of the Macs’ file system. In
file names on Macs, many
non-<a href="http://en.wikipedia.org/wiki/ASCII">ASCII</a> characters are
<a href="http://en.wikipedia.org/wiki/Precomposed_character#Comparing_precomposed_and_decomposed_characters">decomposed</a>.
For example, the character
“<a href="http://www.fileformat.info/info/unicode/char/00fc/index.htm">ü</a>” is
stored as
“<a href="http://www.fileformat.info/info/unicode/char/0075/index.htm">u</a>”
plus the
<a href="http://www.fileformat.info/info/unicode/char/0308/index.htm">dots</a> as
an extra character.</p>
<p>Most of the time this is completely harmless. But when the text in the
field contains an un-decomposed character, for example “<code>&lt;img
src="Tübingen_Neckarfront.jpg" /&gt;</code>” and that text together with the
file with the decomposed name, “<code>Tübingen_Neckarfront.jpg</code>”, are
synced to a Linux or Windows machine, those two strings do not point
to the same file. The result is that the file isn’t show during
review. At the moment (January 2013, Anki 2.0.6), the
“Tools/Maintenance/Unused media...”  file will not detect this
problem, it only becomes apparent during reviews or when browsing the
cards.</p>
<h2>The solution</h2>
<p>The add-on goes through the collection and renames media file to those
used in the collection when the on-disk name is the Mac OS X version
of that in the collection.</p>
<blockquote class="nb">This add-on in a hack. It worked well for me,
but might introduce errors in the collection. Caveat
emptor.</blockquote>

<p>This can work only when run on non-Macs. When there is no non-Mac
desktop client available, the only solution to this problem that i see
is to go through the collection and fix the file names by hand. Or
possibly re-download audio clips with a new version of Download audio,
if that is what caused the problems.</p>
<h2>See also</h2>
<p>This issue has been discussed as
<a href="https://anki.lighthouseapp.com/projects/100923/tickets/500-anki-confused-about-some-file-names#ticket-500">one</a>
or possibly
<a href="https://anki.lighthouseapp.com/projects/100923/tickets/559-problems-with-files-containing-umlauts-related-to-500">two</a>
issues at the Anki issue tracker.</p>
    
  </div>

</article>

      <footer>
        <div class="line"></div>
        <span class="by"><a href="https://github.com/ospalh">ospalh</a>
        maintains <a href="https://github.com/ospalh/anki-addons">anki-addons</a></span>
        <a href="http://tutorialzine.com/" class="tmpl">Original
        template: Tutorialzine</a>
      </footer>
    </section>
  
</body>
</html>